"use strict";
var morgan = require("morgan");
var tracker_1 = require("./tracker");
var defaultMakeTrackOptions = function (m, req, res) {
    return {
        eventType: 'request',
        attr: {
            url: m['url'](req, res),
            method: m['method'](req, res),
            status: m['status'](req, res)
        },
        user: req.user,
        metric: 'request/time',
        value: Number(m['response-time'](req, res))
    };
};
function logAndTrack(morganFormat, makeOptions) {
    var morganFormatFunction = morgan.compile(morgan[morganFormat] || morganFormat);
    return morgan(function (m, req, res) {
        var trackOptions = makeOptions ? makeOptions(m, req, res) : defaultMakeTrackOptions(m, req, res);
        tracker_1.TRACKER.track(trackOptions);
        return morganFormatFunction(m, req, res);
    });
}
exports.logAndTrack = logAndTrack;
